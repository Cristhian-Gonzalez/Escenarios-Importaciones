<!DOCTYPE html>
<html lang="es-PY">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacitaci√≥n: Compras y Comercio Exterior</title>
    <style>
        :root {
            /* Cambio de color para Cl√∫ster Compras/Importaciones: Azul Oc√©ano */
            --color-primary: #006994;
            --color-primary-dark: #004d6e;
            --color-text: #333333;
            --color-text-light: #666666;
            --color-background: #f0f4f8; /* Fondo ligeramente azulado */
            --color-card: #ffffff;
            --color-border: #d1d9e6;
            --color-white: #ffffff;
            --color-header-inactive: #dceef7;
            --color-header-hover: #c4e0f0;
            --color-role-tag: #9ebbc9;
            --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --border-radius: 8px;
            --transition-speed: 0.3s;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-family-base); background-color: var(--color-background); color: var(--color-text); line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; padding: var(--spacing-lg); }
        header { background-color: var(--color-card); padding: var(--spacing-lg); border-radius: var(--border-radius); margin-bottom: var(--spacing-lg); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.05); }
        .header-top { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: var(--spacing-md); }
        .title-block h1 { color: var(--color-primary-dark); font-size: 1.8rem; margin: 0; line-height: 1.1; }
        .title-block .subtitle { font-size: 1.5rem; color: var(--color-text); margin: 0; line-height: 1.2; font-weight: 600; }
        .version-info { font-size: 0.9rem; font-style: italic; color: var(--color-text-light); white-space: nowrap; margin-left: var(--spacing-md); }
        .controls { display: flex; flex-direction: column; gap: var(--spacing-md); }
        .search-wrapper, .anchor-nav { position: relative; }
        #search-input, #anchor-select { width: 100%; padding: 12px 12px 12px 40px; border: 1px solid var(--color-border); border-radius: var(--border-radius); font-size: 1rem; }
        .search-wrapper::before, .anchor-nav::before { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 1.2rem; opacity: 0.5; }
        .search-wrapper::before { content: 'üîç'; }
        .anchor-nav::before { content: '‚öì'; pointer-events: none; }
        #anchor-select { cursor: pointer; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23cccccc' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center;}
        #filters { display: flex; flex-wrap: wrap; gap: var(--spacing-sm); justify-content: center; }
        .filter-btn { background-color: #ffffff; color: var(--color-text-light); border: 1px solid var(--color-border); padding: var(--spacing-sm) var(--spacing-md); border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all var(--transition-speed); display: inline-flex; align-items: center; gap: var(--spacing-sm); }
        .filter-btn:hover { background-color: #e6f7ff; color: var(--color-primary); border-color: var(--color-primary); }
        .filter-btn.active { background-color: var(--color-primary); color: var(--color-white); border-color: var(--color-primary-dark); font-weight: bold; }
        .icon { width: 18px; height: 18px; }
        .filter-btn.active .icon { filter: brightness(0) invert(1); }
        #scenarios-container { display: grid; gap: var(--spacing-md); }
        .scenario { background-color: var(--color-card); border: 1px solid var(--color-border); border-radius: var(--border-radius); overflow: hidden; }
        .scenario-header { padding: var(--spacing-md) var(--spacing-lg); cursor: pointer; display: flex; justify-content: space-between; align-items: center; gap: var(--spacing-md); transition: background-color var(--transition-speed); background-color: var(--color-header-inactive); }
        .scenario-header:hover { background-color: var(--color-header-hover); }
        .scenario-title { font-size: 1.1rem; font-weight: 600; flex-grow: 1; }
        .scenario-role { display: flex; align-items: center; gap: var(--spacing-sm); font-size: 0.9rem; color: var(--color-white); background-color: var(--color-role-tag); padding: 4px var(--spacing-sm); border-radius: 12px; white-space: nowrap; }
        .scenario-header::after { content: '‚ñº'; font-size: 0.8rem; transition: transform var(--transition-speed); color: var(--color-text-light); }
        .scenario.open > .scenario-header::after { transform: rotate(180deg); }
        .scenario-content { display: grid; grid-template-rows: 0fr; transition: grid-template-rows var(--transition-speed) ease-in-out; }
        .scenario.open > .scenario-content { grid-template-rows: 1fr; }
        .scenario-content-inner { overflow: hidden; padding: 0 var(--spacing-lg); }
        .scenario.open .scenario-content-inner { padding: var(--spacing-lg); border-top: 1px solid var(--color-border); }
        .situation { margin-bottom: var(--spacing-md); padding-left: var(--spacing-md); border-left: 3px solid var(--color-primary); }
        .situation h3, .solution h3 { font-size: 1rem; margin-bottom: var(--spacing-sm); color: var(--color-primary-dark); }
        .solution-toggle { background-color: var(--color-primary); color: var(--color-white); border: none; padding: 10px 15px; border-radius: var(--border-radius); cursor: pointer; font-size: 0.9rem; font-weight: bold; transition: background-color var(--transition-speed); margin-bottom: var(--spacing-md); }
        .solution-toggle:hover { background-color: var(--color-primary-dark); }
        .solution { background-color: rgba(0, 105, 148, 0.05); border: 1px solid rgba(0, 105, 148, 0.2); border-radius: var(--border-radius); padding: var(--spacing-md); }
        .solution ul { list-style-position: inside; padding-left: var(--spacing-sm); }
        .solution ul li { margin-bottom: var(--spacing-sm); }
        [hidden] { display: none !important; }
        .floating-actions { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: var(--spacing-md); z-index: 110; }
        .fab { background-color: var(--color-primary); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); display: grid; place-items: center; transition: opacity 0.3s, transform 0.3s; opacity: 0; transform: scale(0.8); pointer-events: none; }
        .fab.visible { opacity: 1; transform: scale(1); pointer-events: auto; }
        .fab:hover { background-color: var(--color-primary-dark); transform: scale(1.05); }
        @media (max-width: 600px) { .header-top { flex-direction: column; align-items: flex-start; } .scenario-header { flex-direction: column; align-items: flex-start; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div class="title-block">
                    <h1>Compras y Comercio Exterior</h1>
                    <p class="subtitle">Manual de Entrenamiento: Escenarios de Importaciones</p>
                </div>
                <span class="version-info">PG-CM-04 Ver 01</span>
            </div>
            <div class="controls">
                <div class="search-wrapper"><input type="search" id="search-input" placeholder="Buscar por palabra clave..."></div>
                <div class="anchor-nav"><select id="anchor-select"></select></div>
                <div id="filters"></div>
            </div>
        </header>
        <main id="scenarios-container"></main>
    </div>
    <div class="floating-actions">
        <button id="close-all-btn" class="fab" title="Cerrar todos los escenarios"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg></button>
        <button id="back-to-top" class="fab" title="Volver arriba"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"/></svg></button>
    </div>
    <script>
    const scenarios = [
        {
            "id": 1,
            "title": "El C√≥digo Nuevo (Sin Padrinos)",
            "roles": ["Importaciones"],
            "situation": "Marketing pide traer 'L√°minas UV Premium' urgentes. El Asistente de Importaciones crea un c√≥digo gen√©rico 'LAMINAS-001' y carga el pedido para ganar tiempo.",
            "solution": "El IT-CM-02 exige 'coordinar con el Gerente Comercial T√©cnico para acordar la descripci√≥n'. Crear c√≥digos basura ensucia la base de datos y complica el despacho aduanero posterior (clasificaci√≥n arancelaria incorrecta)."
        },
        {
            "id": 2,
            "title": "La Proforma con Extras (Flete Incluido)",
            "roles": ["Importaciones"],
            "situation": "El proveedor chino env√≠a una Proforma que dice 'TOTAL CFR ASUNCION: $10,000'. El Asistente carga el pedido en el sistema poniendo $10,000 como costo de la mercader√≠a (FOB).",
            "solution": "Error Operativo: Inflaci√≥n del costo del producto e impuestos incorrectos. Se debe prorratear y separar el costo del flete (CFR = Cost + Freight) del valor FOB para la correcta liquidaci√≥n de impuestos en Aduana."
        }
    ];

    document.addEventListener('DOMContentLoaded', () => {
        const scenariosContainer = document.getElementById('scenarios-container');
        const searchInput = document.getElementById('search-input');
        const filtersContainer = document.getElementById('filters');
        const anchorSelect = document.getElementById('anchor-select');
        const backToTopButton = document.getElementById('back-to-top');
        const closeAllButton = document.getElementById('close-all-btn');
        let activeFilter = 'Todos';
        const SESSION_STORAGE_KEY = 'openScenariosCompras'; // Clave √∫nica para este manual
        
        // Iconos actualizados para el Cl√∫ster de Compras
        const icons = {
            "Importaciones": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 21c-1.39 0-2.78-.47-4-1.32-2.44 1.71-5.56 1.71-8 0C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 2.52 1.29 5.48 1.29 8 0 1.26.65 2.62.99 4 .99h2v-2h-2zM3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l.02-1.91C18.49 16.61 17.37 15.92 16.5 15c-1.31-1.38-3.07-1.36-4.22-.16l-1.55 1.62L9.22 14.9C8.07 13.7 6.31 13.72 5 15.1c-.87.92-1.99 1.61-3.57 2.09L3.95 19zM6 6v2.34l2 1V5H6zm8.8 1.8l2-1V5h-2v2.8zm-4.4 2.2l2-1V5h-2v4zM18 1L6 4.6V5h12V1z"/></svg>`,
            "Compras": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>`,
            "Log√≠stica": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 1c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zM6 1C3.24 1 1 3.24 1 6s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm12 6H6c-2.76 0-5 2.24-5 5v3h22v-3c0-2.76-2.24-5-5-5zm-12 6c0-1.66 1.34-3 3-3h10c1.66 0 3 1.34 3 3v1H6v-1z"/></svg>`,
            "Dep√≥sito": `<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 8h-3V4H7v4H4c-1.1 0-2 .9-2 2v10h20V10c0-1.1-.9-2-2-2zM9 6h6v2H9V6zm11 12H4v-3h2v1h2v-1h8v1h2v-1h2v3zm-5-5H8v-2h8v2z"/></svg>`
        };
        const getIconForRole = (role) => icons[role] || '';
        
        const renderScenarios = (scenariosToRender) => {
            scenariosContainer.innerHTML = '';
            scenariosToRender.forEach(s => {
                const scenarioEl = document.createElement('article');
                scenarioEl.className = 'scenario';
                scenarioEl.dataset.id = s.id;
                scenarioEl.id = `escenario-${s.id}`;
                scenarioEl.innerHTML = `
                    <header class="scenario-header" role="button" aria-expanded="false"><h2 class="scenario-title">${s.id}: ${s.title}</h2><div class="roles-wrapper">${s.roles.map(r => `<span class="scenario-role">${getIconForRole(r)}${r}</span>`).join('')}</div></header>
                    <div class="scenario-content">
                        <div class="scenario-content-inner">
                            <div class="situation"><h3>Situaci√≥n</h3><p>${s.situation}</p></div>
                            <button class="solution-toggle" aria-expanded="false">Ver Soluci√≥n Recomendada</button>
                            <div class="solution" hidden><h3>Soluci√≥n Recomendada</h3><ul>${s.solution.split('\n').map(l => `<li>${l}</li>`).join('')}</ul></div>
                        </div>
                    </div>`;
                scenariosContainer.appendChild(scenarioEl);
            });
        };
        
        const renderFilters = () => {
            const allRoles = [...new Set(scenarios.flatMap(s => s.roles))];
            let filtersHtml = `<button class="filter-btn active" data-role="Todos">Todos</button>`;
            allRoles.sort().forEach(role => { filtersHtml += `<button class="filter-btn" data-role="${role}">${getIconForRole(role)}${role}</button>`; });
            filtersContainer.innerHTML = filtersHtml;
        };
        
        const renderAnchorNav = () => {
            anchorSelect.innerHTML = '<option value="">Saltar a un escenario...</option>';
            scenarios.forEach(s => { const o = document.createElement('option'); o.value = s.id; o.textContent = `${s.id}: ${s.title}`; anchorSelect.appendChild(o); });
        };
        
        const filterAndSearch = () => {
            const searchTerm = searchInput.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            let filtered = scenarios.filter(s => activeFilter === 'Todos' || s.roles.includes(activeFilter));
            if (searchTerm) {
                filtered = filtered.filter(s => Object.values(s).join(' ').toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(searchTerm));
            }
            renderScenarios(filtered);
            loadState();
        };
        
        const saveState = () => { sessionStorage.setItem(SESSION_STORAGE_KEY, JSON.stringify(Array.from(document.querySelectorAll('.scenario.open')).map(el => el.dataset.id))); };
        const loadState = () => { JSON.parse(sessionStorage.getItem(SESSION_STORAGE_KEY) || '[]').forEach(id => { const el = document.querySelector(`.scenario[data-id='${id}']`); if (el) { el.classList.add('open'); el.querySelector('.scenario-header').setAttribute('aria-expanded', 'true'); } }); };
        
        // Event Listener para b√∫squeda en tiempo real (Fix aplicado)
        searchInput.addEventListener('input', filterAndSearch);
        
        filtersContainer.addEventListener('click', e => { if (e.target.closest('.filter-btn')) { filtersContainer.querySelector('.active').classList.remove('active'); e.target.closest('.filter-btn').classList.add('active'); activeFilter = e.target.closest('.filter-btn').dataset.role; filterAndSearch(); } });
        anchorSelect.addEventListener('change', e => { if (e.target.value) { const target = document.getElementById(`escenario-${e.target.value}`); if (target) { if (!target.classList.contains('open')) { target.querySelector('.scenario-header').click(); } target.scrollIntoView({ behavior: 'smooth', block: 'center' }); } e.target.selectedIndex = 0; } });
        closeAllButton.addEventListener('click', () => { document.querySelectorAll('.scenario.open').forEach(s => { s.classList.remove('open'); s.querySelector('.scenario-header').setAttribute('aria-expanded', 'false'); }); sessionStorage.removeItem(SESSION_STORAGE_KEY); });
        scenariosContainer.addEventListener('click', e => { const header = e.target.closest('.scenario-header'); if (header) { const s = header.parentElement; s.classList.toggle('open'); header.setAttribute('aria-expanded', s.classList.contains('open')); saveState(); } const solToggle = e.target.closest('.solution-toggle'); if (solToggle) { const solDiv = solToggle.nextElementSibling; const isExp = solToggle.getAttribute('aria-expanded') === 'true'; solToggle.setAttribute('aria-expanded', !isExp); solDiv.hidden = isExp; solToggle.textContent = isExp ? 'Ver Soluci√≥n' : 'Ocultar Soluci√≥n'; } });
        
        const checkScroll = () => { backToTopButton.classList.toggle('visible', document.documentElement.scrollTop > 100); closeAllButton.classList.toggle('visible', document.querySelector('.scenario.open') !== null); };
        window.addEventListener('scroll', checkScroll);
        scenariosContainer.addEventListener('click', () => setTimeout(checkScroll, 350));
        closeAllButton.addEventListener('click', () => setTimeout(checkScroll, 350));
        backToTopButton.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
        
        renderFilters(); renderAnchorNav(); renderScenarios(scenarios); loadState(); checkScroll();
    });
    </script>
</body>
</html>
